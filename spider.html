
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SEEZU | Spider Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- üîê AES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
body{
 margin:0;
 font-family:Arial;
 background:#fde7f0;
}
.popup{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.35);
 display:flex;
 justify-content:center;
 align-items:center;
}
.box{
 background:#fff0f6;
 width:330px;
 padding:20px;
 border-radius:26px;
 text-align:center;
 box-shadow:0 20px 35px rgba(0,0,0,.25);
 position:relative;
}
.close{
 position:absolute;
 top:10px;
 right:15px;
 cursor:pointer;
}
.avatar{
 width:90px;
 height:90px;
 border-radius:50%;
 object-fit:cover;
 box-shadow:0 6px 15px rgba(0,0,0,.2);
 cursor:pointer;
}
h3{color:#ff5c8d;margin:8px 0}
small{font-size:12px;color:#777}

.pm{
 background:#ffe6f0;
 padding:12px;
 border-radius:20px;
 margin-top:10px;
}
.pm input,.pm button{
 width:100%;
 padding:8px;
 margin:5px 0;
 border-radius:15px;
 border:1px solid #ff9bb8;
}
.pm button{
 background:#ff5c8d;
 color:#fff;
 border:none;
}

.btn{
 display:block;
 background:#ff5c8d;
 color:white;
 padding:8px;
 margin:6px 0;
 border-radius:18px;
 text-decoration:none;
}
.logout{
 background:#ff1744;
 color:white;
 border:none;
 padding:9px;
 border-radius:18px;
 width:100%;
 margin-top:8px;
}
</style>
</head>

<body>

<div class="popup">
 <div class="box">

  <span class="close" onclick="history.back()">‚úñ</span>

  <!-- üë§ PROFILE -->
  <img id="profileImg"
       src="https://i.imgur.com/8Km9tLL.png"
       class="avatar"
       title="Tap to change photo">

  <input type="file" id="photoInput" accept="image/*" hidden>
  <small>Tap photo to change</small>

  <h3 id="username" contenteditable="true">@loading...</h3>

  <!-- üîê PASSWORD MANAGER -->
  <div class="pm">
   <h4>üîê Password Manager</h4>

   <input type="password" id="master" placeholder="Master Password">
   <button onclick="unlock()">Unlock</button>

   <div id="vault" style="display:none">
    <input id="site" placeholder="Website / App">
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="savePass()">Save</button>
    <div id="list"></div>
   </div>
  </div>

  <!-- ‚öôÔ∏è SETTINGS -->
  <a class="btn" href="O.html">‚öôÔ∏è Account Settings</a>
  <a class="btn" href="OO.html">üé® Theme Settings</a>
  <a class="btn" href="OOO.html">üîî Notifications</a>

  <!-- üö™ LOGOUT -->
  <button class="logout" id="logoutBtn">Logout</button>

 </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

/* üî• SAME FIREBASE PROJECT */
const firebaseConfig = {
 apiKey: "AIzaSyBkHcQJJ4HXU4R23J2nBy1z4ElL3_Hr1D0",
 authDomain: "seezu-1066d.firebaseapp.com",
 projectId: "seezu-1066d",
 storageBucket: "seezu-1066d.appspot.com"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

const nameBox = document.getElementById("username");
const img = document.getElementById("profileImg");
const input = document.getElementById("photoInput");

let MASTER="";

/* üîê AUTH CHECK + LOAD USER */
onAuthStateChanged(auth, async (user)=>{
 if(!user){
  location.href="login.html";
  return;
 }
 const snap = await getDoc(doc(db,"users",user.uid));
 if(snap.exists()){
  const d=snap.data();
  nameBox.innerText="@"+d.username;
  if(d.photoURL) img.src=d.photoURL;
 }
});

/* ‚úèÔ∏è USERNAME SAVE */
nameBox.addEventListener("blur", async ()=>{
 const u=auth.currentUser;
 if(!u) return;
 await updateDoc(doc(db,"users",u.uid),{
  username:nameBox.innerText.replace("@","")
 });
});

/* üì∏ PHOTO UPLOAD */
img.onclick=()=>input.click();
input.onchange=async ()=>{
 const u=auth.currentUser;
 const file=input.files[0];
 if(!file) return;

 const r=ref(storage,"profilePhotos/"+u.uid);
 await uploadBytes(r,file);
 const url=await getDownloadURL(r);

 img.src=url;
 await updateDoc(doc(db,"users",u.uid),{photoURL:url});
};

/* üîê PASSWORD MANAGER */
window.unlock=()=>{
 MASTER=master.value;
 if(!MASTER) return alert("Enter master password");
 vault.style.display="block";
 loadPass();
};

window.savePass=async ()=>{
 const enc=CryptoJS.AES.encrypt(pass.value,MASTER).toString();
 await addDoc(collection(db,"passwords"),{
  uid:auth.currentUser.uid,
  site:site.value,
  user:user.value,
  pass:enc
 });
 loadPass();
};

async function loadPass(){
 const snap=await getDocs(collection(db,"passwords"));
 let html="";
 snap.forEach(d=>{
  const x=d.data();
  if(x.uid===auth.currentUser.uid){
   const dec=CryptoJS.AES.decrypt(x.pass,MASTER)
             .toString(CryptoJS.enc.Utf8);
   html+=`<hr>üåê ${x.site}<br>üë§ ${x.user}<br>üîë ${dec}`;
  }
 });
 list.innerHTML=html;
}

/* üö™ LOGOUT */
logoutBtn.onclick=async ()=>{
 await signOut(auth);
 location.href="login.html";
};
</script>

</body>
</html>

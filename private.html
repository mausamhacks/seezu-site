<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SEEZU | Private Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
 margin:0;
 font-family:Arial, sans-serif;
 background:#fde7f0;
}
.app{
 max-width:420px;
 margin:auto;
 height:100vh;
 display:flex;
 flex-direction:column;
}
.header{
 background:#ff5c8d;
 color:#fff;
 padding:12px;
 text-align:center;
 font-weight:bold;
}
.messages{
 flex:1;
 overflow-y:auto;
 padding:10px;
}
.msg{
 display:flex;
 gap:8px;
 margin-bottom:10px;
}
.dp{
 width:36px;
 height:36px;
 border-radius:50%;
 object-fit:cover;
}
.bubble{
 background:#fff;
 padding:8px 12px;
 border-radius:14px;
 max-width:75%;
 box-shadow:0 3px 8px rgba(0,0,0,.1);
}
.nick{
 font-size:12px;
 font-weight:bold;
 color:#ff5c8d;
}
.text{
 margin-top:2px;
}
.ctrl{
 font-size:11px;
 margin-top:4px;
 color:#888;
}
.ctrl span{
 margin-right:10px;
 cursor:pointer;
}
.input-box{
 display:flex;
 padding:8px;
 background:#fff;
 gap:8px;
}
.input-box input{
 flex:1;
 padding:10px;
 border-radius:20px;
 border:1px solid #ccc;
 outline:none;
}
.input-box button{
 border:none;
 background:#ff5c8d;
 color:#fff;
 padding:10px 16px;
 border-radius:20px;
}
</style>
</head>

<body>

<div class="app">
 <div class="header">ðŸ”’ Private Room</div>
 <div id="messages" class="messages"></div>

 <div class="input-box">
  <input id="msg" placeholder="Type message ðŸ’—">
  <button onclick="sendMsg()">Send</button>
 </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* ðŸ”¥ USE YOUR EXISTING FIREBASE CONFIG */
const firebaseConfig = {
 apiKey: "PASTE_KEY",
 authDomain: "seezu-1066d.firebaseapp.com",
 databaseURL: "https://seezu-1066d-default-rtdb.firebaseio.com",
 projectId: "seezu-1066d"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ðŸ‘¤ USER INFO */
let nick = localStorage.getItem("nick") || prompt("Nickname");
let dp   = localStorage.getItem("dp")   || prompt("Paste DP image URL");
localStorage.setItem("nick",nick);
localStorage.setItem("dp",dp);

/* ðŸ”‘ PRIVATE ROOM CODE */
let room = prompt("Enter private room code");
const chatRef = ref(db,"privateRooms/"+room+"/messages");

/* âœ‰ï¸ SEND MESSAGE (KEYBOARD FIX) */
window.sendMsg = ()=>{
 let t = msg.value.trim();
 if(!t) return;

 push(chatRef,{
  nick:nick,
  dp:dp,
  text:t,
  time:Date.now()
 });

 msg.value="";
 msg.focus();   // âœ… KEYBOARD STAYS OPEN
};

/* ðŸ“¥ LOAD MESSAGES */
onValue(chatRef,snap=>{
 messages.innerHTML="";
 snap.forEach(c=>{
  let d=c.val();
  let div=document.createElement("div");
  div.className="msg";
  div.innerHTML=`
   <img class="dp" src="${d.dp}">
   <div class="bubble">
    <div class="nick">${d.nick}</div>
    <div class="text" id="t_${c.key}">${d.text}</div>
    <div class="ctrl">
     <span onclick="editMsg('${c.key}')">edit</span>
     <span onclick="delMsg('${c.key}')">delete</span>
     <span onclick="unsendMsg('${c.key}')">unsend</span>
    </div>
   </div>
  `;
  messages.appendChild(div);
 });
 messages.scrollTop = messages.scrollHeight;
});

/* âœï¸ EDIT */
window.editMsg = (id)=>{
 let n = prompt("Edit message");
 if(n) update(ref(db,"privateRooms/"+room+"/messages/"+id),{text:n});
};

/* ðŸ—‘ï¸ DELETE */
window.delMsg = (id)=>{
 remove(ref(db,"privateRooms/"+room+"/messages/"+id));
};

/* ðŸš« UNSEND */
window.unsendMsg = (id)=>{
 update(ref(db,"privateRooms/"+room+"/messages/"+id),{text:"ðŸš« Message unsent"});
};
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SEEZU | Ultimate Private Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#fde7f0}
.app{max-width:420px;margin:auto;height:100vh;display:flex;flex-direction:column}
.header{background:#ff5c8d;color:#fff;padding:12px;text-align:center;font-weight:bold}
.messages{flex:1;overflow-y:auto;padding:10px;padding-bottom:120px}
.msg{display:flex;margin-bottom:10px}
.dp{width:34px;height:34px;border-radius:50%;object-fit:cover}
.bubble{max-width:72%;padding:8px 12px;border-radius:16px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
.nick{font-size:12px;font-weight:bold}
.reply{font-size:11px;opacity:.7;border-left:3px solid #ff5c8d;padding-left:6px;margin-bottom:4px}
.ctrl{font-size:11px;margin-top:4px}
.ctrl span{margin-right:8px;cursor:pointer}
.react span{cursor:pointer;margin-right:4px}
.seen{font-size:11px;opacity:.6;text-align:right}

.input-box{
 position:fixed;bottom:0;left:50%;transform:translateX(-50%);
 max-width:420px;width:100%;display:flex;gap:6px;
 padding:8px;background:#fff;box-shadow:0 -2px 10px rgba(0,0,0,.15)
}
.input-box input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc}
.input-box button{background:#ff5c8d;color:#fff;border:none;padding:10px 14px;border-radius:20px}
.typing{font-size:12px;padding:6px 10px;opacity:.7}
</style>
</head>

<body>
<div class="app">
 <div class="header">üîí Private Room</div>
 <div id="messages" class="messages"></div>
 <div id="typing" class="typing"></div>

 <div class="input-box">
  <input id="msg" placeholder="Type message üíó">
  <button onclick="send()">Send</button>
 </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove, set }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig = {
 apiKey:"PASTE_KEY",
 authDomain:"seezu-1066d.firebaseapp.com",
 databaseURL:"https://seezu-1066d-default-rtdb.firebaseio.com",
 projectId:"seezu-1066d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* USER */
let nick = localStorage.getItem("nick") || prompt("Nickname");
let dp   = localStorage.getItem("dp") || prompt("DP image URL");
localStorage.setItem("nick",nick);
localStorage.setItem("dp",dp);

/* ROOM */
let room = prompt("Room code");
const base = "privateRooms/"+room;
const msgRef = ref(db,base+"/messages");
const typingRef = ref(db,base+"/typing/"+nick);
const statusRef = ref(db,base+"/status/"+nick);

/* ONLINE */
set(statusRef,{online:true,last:Date.now()});
window.addEventListener("beforeunload",()=>set(statusRef,{online:false,last:Date.now()}));

/* SEND */
window.send=()=>{
 if(!msg.value.trim())return;
 push(msgRef,{
  nick,dp,text:msg.value,
  time:Date.now(),seen:false,reply:null,reactions:{}
 });
 msg.value="";msg.focus();set(typingRef,false);
};

/* TYPING */
msg.oninput=()=>{set(typingRef,true);setTimeout(()=>set(typingRef,false),1200)};

/* SHOW */
onValue(msgRef,snap=>{
 messages.innerHTML="";
 snap.forEach(c=>{
  let d=c.val(),isMe=d.nick===nick;
  if(!isMe) update(ref(db,base+"/messages/"+c.key),{seen:true});

  let div=document.createElement("div");
  div.className="msg";
  div.style.justifyContent=isMe?"flex-end":"flex-start";

  div.innerHTML=`
  ${!isMe?`<img class="dp" src="${d.dp}">`:""}
  <div class="bubble" style="background:${isMe?'#ff5c8d':'#fff'};color:${isMe?'#fff':'#000'}">
   <div class="nick">${isMe?'You':d.nick}</div>
   ${d.reply?`<div class="reply">${d.reply}</div>`:""}
   <div>${d.text}</div>
   <div class="react">
    <span onclick="react('${c.key}','‚ù§Ô∏è')">‚ù§Ô∏è</span>
    <span onclick="react('${c.key}','üòÇ')">üòÇ</span>
    <span onclick="react('${c.key}','üî•')">üî•</span>
   </div>
   ${isMe?`
   <div class="ctrl">
    <span onclick="editMsg('${c.key}')">edit</span>
    <span onclick="delMsg('${c.key}')">delete</span>
    <span onclick="unsend('${c.key}')">unsend</span>
   </div>
   <div class="seen">${d.seen?'‚úî‚úî Seen':'‚úî Sent'}</div>`:""}
  </div>
  ${isMe?`<img class="dp" src="${d.dp}">`:""}
  `;
  messages.appendChild(div);
 });
 messages.scrollTop=messages.scrollHeight;
});

/* REACTION */
window.react=(id,e)=>{
 update(ref(db,base+"/messages/"+id+"/reactions/"+nick),e);
};

/* EDIT / DELETE */
window.editMsg=id=>{
 let t=prompt("Edit");if(t)update(ref(db,base+"/messages/"+id),{text:t})
};
window.delMsg=id=>remove(ref(db,base+"/messages/"+id));
window.unsend=id=>update(ref(db,base+"/messages/"+id),{text:"üö´ Message unsent"});

/* TYPING SHOW */
onValue(ref(db,base+"/typing"),s=>{
 let t="";s.forEach(c=>{if(c.key!==nick && c.val())t="Typing..."});
 typing.innerText=t;
});
</script>
</body>
</html>

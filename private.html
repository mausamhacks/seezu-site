<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SEEZU | Ultimate Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
 --bubble:#ff5c8d;
 --bg:#fde7f0;
}
body{margin:0;font-family:Arial;background:var(--bg)}
.app{max-width:420px;margin:auto;height:100vh;display:flex;flex-direction:column}
.header{background:var(--bubble);color:#fff;padding:12px;text-align:center;font-weight:bold}

.messages{
 flex:1;overflow-y:auto;padding:10px;padding-bottom:150px;
 background-size:cover;background-position:center;
}

/* MESSAGE */
.msg{display:flex;margin-bottom:10px;animation:in .25s ease}
@keyframes in{from{opacity:0;transform:translateY(8px)}to{opacity:1}}

.dp{width:34px;height:34px;border-radius:50%}
.bubble{
 max-width:72%;padding:8px 12px;border-radius:16px;
 background:var(--bubble);color:#fff;
 box-shadow:0 2px 6px rgba(0,0,0,.15)
}
.left .bubble{background:#fff;color:#000}
.nick{font-size:12px;font-weight:bold}

/* INPUT */
.input-box{
 position:fixed;bottom:0;left:50%;transform:translateX(-50%);
 max-width:420px;width:100%;display:flex;gap:6px;
 padding:8px;background:#fff;box-shadow:0 -2px 10px rgba(0,0,0,.15)
}
textarea{flex:1;resize:none;padding:10px;border-radius:18px;border:1px solid #ccc}
button{border:none;background:var(--bubble);color:#fff;padding:10px 14px;border-radius:18px}

/* ü§åüèª MENU */
.menu-btn{background:none;color:var(--bubble);font-size:22px}
.menu{
 position:absolute;bottom:70px;left:10px;
 background:#fff;border-radius:16px;
 padding:10px;box-shadow:0 5px 20px rgba(0,0,0,.2);
 display:none;animation:pop .25s ease
}
@keyframes pop{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}

.menu button{
 display:block;width:100%;margin:6px 0;
 background:#fce4ec;color:#000
}

/* MEDIA */
img.chat-img,video{max-width:100%;border-radius:12px;margin-top:6px}
audio{width:100%;margin-top:6px}
</style>
</head>

<body>

<div class="app">
 <div class="header">üîí Private Room</div>

 <div id="messages" class="messages"></div>

 <div class="menu" id="menu">
  <button onclick="pickMedia('image')">üì∑ Photo</button>
  <button onclick="pickMedia('video')">üé• Video</button>
  <button onclick="recordVoice()">üé§ Voice</button>
  <button onclick="pickMedia('audio')">üé∂ Music</button>
  <button onclick="pickWallpaper()">üñºÔ∏è Wallpaper</button>
  <button onclick="changeTheme()">üé® Theme</button>
  <button onclick="toggleNotify()">üîî Notification</button>
 </div>

 <div class="input-box">
  <button class="menu-btn" onclick="toggleMenu()">ü§åüèª</button>
  <textarea id="msg" placeholder="Message üíó"></textarea>
  <button onclick="sendText()">Send</button>
 </div>
</div>

<input type="file" id="fileInput" hidden>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push, onValue }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* FIREBASE (MESSAGES ONLY) */
const firebaseConfig={
 apiKey:"PASTE_KEY",
 authDomain:"seezu-1066d.firebaseapp.com",
 databaseURL:"https://seezu-1066d-default-rtdb.firebaseio.com",
 projectId:"seezu-1066d"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* CLOUDINARY */
const CLOUD="dvvymqh4w";
const PRESET="seezu_upload";

/* USER */
let nick=localStorage.getItem("nick")||prompt("Nickname");
let dp=localStorage.getItem("dp")||prompt("DP URL");
localStorage.setItem("nick",nick);
localStorage.setItem("dp",dp);

/* ROOM */
let room=prompt("Room code");
const msgRef=ref(db,"rooms/"+room);

/* MENU */
window.toggleMenu=()=>menu.style.display=menu.style.display?"":"block";

/* TEXT */
window.sendText=()=>{
 if(!msg.value.trim())return;
 push(msgRef,{nick,dp,type:"text",text:msg.value,time:Date.now()});
 msg.value="";
};

/* CLOUDINARY UPLOAD */
async function uploadCloud(file,type){
 let resource = (type==="image")?"image":"video";
 let fd=new FormData();
 fd.append("file",file);
 fd.append("upload_preset",PRESET);
 let r=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD}/${resource}/upload`,{
  method:"POST",body:fd
 });
 let d=await r.json();
 return d.secure_url;
}

/* PICK MEDIA */
window.pickMedia=(type)=>{
 fileInput.accept=type+"/*";
 fileInput.click();
 fileInput.onchange=async()=>{
  let f=fileInput.files[0];if(!f)return;
  let url=await uploadCloud(f,type);
  push(msgRef,{nick,dp,type,url,time:Date.now()});
 };
};

/* VOICE NOTE */
window.recordVoice=async()=>{
 let s=await navigator.mediaDevices.getUserMedia({audio:true});
 let r=new MediaRecorder(s),c=[];
 r.start();
 r.ondataavailable=e=>c.push(e.data);
 setTimeout(()=>r.stop(),3000);
 r.onstop=async()=>{
  let b=new Blob(c,{type:"audio/webm"});
  let url=await uploadCloud(b,"video");
  push(msgRef,{nick,dp,type:"voice",url,time:Date.now()});
 };
};

/* THEME */
window.changeTheme=()=>{
 let colors=["#ff5c8d","#7c4dff","#4caf50","#ff9800"];
 let c=colors[Math.floor(Math.random()*colors.length)];
 document.documentElement.style.setProperty("--bubble",c);
};

/* WALLPAPER */
window.pickWallpaper=()=>{
 fileInput.accept="image/*";
 fileInput.click();
 fileInput.onchange=()=>{
  let f=fileInput.files[0];if(!f)return;
  let r=new FileReader();
  r.onload=e=>{
   messages.style.backgroundImage=`url(${e.target.result})`;
   localStorage.setItem("wall_"+room,e.target.result);
  };
  r.readAsDataURL(f);
 };
};
let w=localStorage.getItem("wall_"+room);
if(w)messages.style.backgroundImage=`url(${w})`;

/* NOTIFICATION */
let notifyOn=localStorage.getItem("notify")==="true";
window.toggleNotify=async()=>{
 if(Notification.permission!=="granted")
  await Notification.requestPermission();
 notifyOn=!notifyOn;
 localStorage.setItem("notify",notifyOn);
 alert("Notification "+(notifyOn?"ON":"OFF"));
};

/* LOAD */
onValue(msgRef,s=>{
 messages.innerHTML="";
 s.forEach(c=>{
  let d=c.val(),me=d.nick===nick;
  if(!me && notifyOn && document.hidden){
   new Notification("New message",{
    body:d.nick+(d.type==="text"?": "+d.text:" sent media"),
    icon:d.dp
   });
  }
  let div=document.createElement("div");
  div.className="msg "+(me?"right":"left");
  div.innerHTML=`
   ${!me?`<img class="dp" src="${d.dp}">`:""}
   <div class="bubble">
    <div class="nick">${me?"You":d.nick}</div>
    ${
     d.type==="text"?d.text:
     d.type==="image"?`<img class="chat-img" src="${d.url}">`:
     d.type==="video"?`<video controls src="${d.url}"></video>`:
     d.type==="audio"?`<audio controls src="${d.url}"></audio>`:
     d.type==="voice"?`<audio controls src="${d.url}"></audio>`:""
    }
   </div>
   ${me?`<img class="dp" src="${d.dp}">`:""}
  `;
  messages.appendChild(div);
 });
 messages.scrollTop=messages.scrollHeight;
});
</script>

</body>
</html>

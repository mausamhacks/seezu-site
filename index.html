<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SEEZU</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#ffe6ef;
  text-align:center;
}
.hidden{display:none}
h1{color:#ff5c8d;font-size:48px}
.card{
  background:#fff;
  margin:20px;
  padding:20px;
  border-radius:25px;
}
input,button{
  width:90%;
  padding:12px;
  margin:6px;
  border-radius:20px;
  border:none;
}
button{
  background:#ff5c8d;
  color:white;
  font-size:16px;
}
.msg{
  background:#ffb3cc;
  padding:10px;
  margin:5px;
  border-radius:15px;
}
img{
  width:240px;
  border-radius:30px;
  animation:float 3s infinite;
}
@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}
</style>
</head>

<body>

<!-- HOME -->
<div id="home">
  <h1>SEEZU</h1>
  <img src="girl.jpg">
  <button onclick="show('login')">Login / Signup</button>
</div>

<!-- LOGIN -->
<div id="login" class="hidden card">
  <h2>Login / Signup</h2>
  <input id="email" placeholder="Email">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="signup()">Signup</button>
  <button onclick="login()">Login</button>
</div>

<!-- CHAT -->
<div id="chat" class="hidden card">
  <h2>Live Chat</h2>
  <div id="messages"></div>
  <input id="msg" placeholder="Type message">
  <button onclick="sendMsg()">Send</button>
  <button onclick="logout()">Logout</button>
  <button onclick="toggleMusic()">Mood / Music</button>
</div>

<audio id="music" loop>
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">
</audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getDatabase,ref,push,onValue,remove }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyBkHcQJJ4HXU4R23J2nBy1z4ElL3_Hr1D0",
  authDomain: "seezu-1066d.firebaseapp.com",
  databaseURL: "https://seezu-1066d-default-rtdb.firebaseio.com",
  projectId: "seezu-1066d"
});

const auth = getAuth(app);
const db = getDatabase(app);

window.show = id=>{
  ["home","login","chat"].forEach(x=>document.getElementById(x).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
};

window.signup=()=>{
  createUserWithEmailAndPassword(auth,email.value,pass.value)
  .then(()=>show("chat"))
  .catch(e=>alert(e.message));
};

window.login=()=>{
  signInWithEmailAndPassword(auth,email.value,pass.value)
  .then(()=>show("chat"))
  .catch(e=>alert(e.message));
};

window.logout=()=>signOut(auth).then(()=>show("home"));

const chatRef = ref(db,"chat");
window.sendMsg=()=>{
  push(chatRef,{
    text:msg.value,
    uid:auth.currentUser.uid
  });
  msg.value="";
};

onValue(chatRef,snap=>{
  messages.innerHTML="";
  snap.forEach(s=>{
    let d=s.val();
    let div=document.createElement("div");
    div.className="msg";
    div.innerText=d.text;
    if(d.uid===auth.currentUser?.uid){
      div.onclick=()=>remove(ref(db,"chat/"+s.key));
    }
    messages.appendChild(div);
  });
});

let playing=false;
window.toggleMusic=()=>{
  let m=document.getElementById("music");
  playing?m.pause():m.play();
  playing=!playing;
};

onAuthStateChanged(auth,u=>{
  if(u) show("chat");
});
</script>

</body>
</html>

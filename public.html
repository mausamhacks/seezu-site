<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SEEZU | Public Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
 --bubble:#ff5c8d;
 --bg:#fde7f0;
}
body{margin:0;font-family:Arial;background:var(--bg)}
.app{max-width:420px;margin:auto;height:100vh;display:flex;flex-direction:column}

/* HEADER */
.header{
 background:var(--bubble);
 color:#fff;
 padding:12px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 font-weight:bold
}
.profile-btn{cursor:pointer;font-size:20px}

/* PROFILE POPUP */
.profile{
 position:fixed;top:60px;right:10px;
 background:#fff;border-radius:16px;
 padding:12px;display:none;
 box-shadow:0 5px 20px rgba(0,0,0,.25);
 z-index:999
}
.profile img{width:70px;height:70px;border-radius:50%}
.profile input{width:100%;padding:8px;margin-top:8px}

/* CHAT */
.messages{
 flex:1;overflow-y:auto;
 padding:10px;padding-bottom:170px;
 background-size:cover;background-position:center
}
.msg{display:flex;margin-bottom:10px;animation:fade .25s ease}
@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1}}
.left{justify-content:flex-start}
.right{justify-content:flex-end}

.dp{width:32px;height:32px;border-radius:50%}
.bubble{
 max-width:72%;
 padding:8px 12px;
 border-radius:16px;
 background:var(--bubble);
 color:#fff;
 box-shadow:0 2px 6px rgba(0,0,0,.15)
}
.left .bubble{background:#fff;color:#000}
.nick{font-size:12px;font-weight:bold}
.reply{font-size:11px;opacity:.7;border-left:3px solid var(--bubble);padding-left:6px}
.seen{font-size:11px;opacity:.6;text-align:right}

/* INPUT */
.input-box{
 position:fixed;bottom:0;left:50%;transform:translateX(-50%);
 max-width:420px;width:100%;
 display:flex;gap:6px;
 padding:8px;background:#fff;
 box-shadow:0 -2px 10px rgba(0,0,0,.15)
}
textarea{flex:1;resize:none;padding:10px;border-radius:18px;border:1px solid #ccc}
button{border:none;background:var(--bubble);color:#fff;padding:10px 14px;border-radius:18px}

/* ğŸ¤ŒğŸ» MENU */
.menu-btn{background:none;color:var(--bubble);font-size:22px}
.menu{
 position:absolute;bottom:70px;left:10px;
 background:#fff;border-radius:16px;
 padding:10px;display:none;
 box-shadow:0 5px 20px rgba(0,0,0,.25)
}
.menu button{display:block;width:100%;margin:6px 0;background:#fce4ec;color:#000}

/* CONTEXT MENU */
.context{
 position:fixed;bottom:120px;left:50%;
 transform:translateX(-50%);
 background:#fff;border-radius:16px;
 display:none;z-index:999;
 box-shadow:0 10px 30px rgba(0,0,0,.3)
}
.context button{
 display:block;width:100%;
 padding:12px;border:none;
 background:none;text-align:left
}
.context button:hover{background:#fce4ec}

/* MEDIA */
img.chat-img,video{max-width:100%;border-radius:12px;margin-top:6px}
audio{width:100%;margin-top:6px}
.typing{font-size:12px;opacity:.6;padding:6px}
</style>
</head>

<body>

<div class="app">

 <div class="header">
  <span>ğŸŒ Public Chat</span>
  <span class="profile-btn" onclick="toggleProfile()">ğŸ‘¤</span>
 </div>

 <div class="profile" id="profile">
  <img id="pdp">
  <input id="pname" placeholder="Username">
  <button onclick="saveProfile()">Save</button>
 </div>

 <div id="messages" class="messages"></div>
 <div id="typing" class="typing"></div>

 <div class="menu" id="menu">
  <button onclick="pickMedia('image')">ğŸ“· Photo</button>
  <button onclick="pickMedia('video')">ğŸ¥ Video</button>
  <button onclick="recordVoice()">ğŸ¤ Voice</button>
  <button onclick="pickMedia('audio')">ğŸ¶ Music</button>
  <button onclick="pickWallpaper()">ğŸ–¼ï¸ Wallpaper</button>
  <button onclick="changeTheme()">ğŸ¨ Theme</button>
 </div>

 <div class="input-box">
  <button class="menu-btn" onclick="menu.style.display=menu.style.display?'':'block'">ğŸ¤ŒğŸ»</button>
  <textarea id="msg" placeholder="Message ğŸ’—"></textarea>
  <button onclick="sendText()">Send</button>
 </div>

</div>

<div class="context" id="context">
 <button onclick="replyMsg()">â†©ï¸ Reply</button>
 <button onclick="editMsg()">âœï¸ Edit</button>
 <button onclick="unsendMsg()">ğŸš« Unsend</button>
 <button onclick="deleteMsg()">ğŸ—‘ï¸ Delete</button>
 <button onclick="downloadMsg()">â¬‡ï¸ Download</button>
</div>

<input type="file" id="fileInput" hidden>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove, set }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* FIREBASE (TUMHARA CONFIG) */
const firebaseConfig={
 apiKey:"AIzaSyBkHcQJJ4HXU4R23J2nBy1z4ElL3_Hr1D0",
 authDomain:"seezu-1066d.firebaseapp.com",
 databaseURL:"https://seezu-1066d-default-rtdb.firebaseio.com",
 projectId:"seezu-1066d"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* CLOUDINARY */
const CLOUD="dvvymqh4w";
const PRESET="seezu_upload";

/* USER */
let nick=localStorage.getItem("nick")||"Guest";
let dp=localStorage.getItem("dp")||"https://i.imgur.com/7k12EPD.png";
pdp.src=dp; pname.value=nick;

/* PUBLIC CHAT PATH */
const base="publicChat";
const msgRef=ref(db,base+"/messages");
const typingRef=ref(db,base+"/typing/"+nick);

/* PROFILE */
window.toggleProfile=()=>profile.style.display=profile.style.display?'':'block';
window.saveProfile=()=>{
 nick=pname.value;
 localStorage.setItem("nick",nick);
 profile.style.display="none";
};

/* SEND TEXT */
window.sendText=()=>{
 if(!msg.value.trim())return;
 push(msgRef,{
  nick,dp,type:"text",text:msg.value,
  time:Date.now(),seen:false
 });
 msg.value="";
};

/* ENTER = SEND */
msg.onkeydown=e=>{
 if(e.key==="Enter"&&!e.shiftKey){
  e.preventDefault();sendText();
 }
};

/* TYPING */
msg.oninput=()=>{
 set(typingRef,true);
 setTimeout(()=>set(typingRef,false),1200);
};
onValue(ref(db,base+"/typing"),s=>{
 let t="";
 s.forEach(c=>{if(c.key!==nick&&c.val())t="Typing..."});
 typing.innerText=t;
});

/* CLOUDINARY UPLOAD */
async function uploadCloud(file,type){
 let res=(type==="image")?"image":"video";
 let fd=new FormData();
 fd.append("file",file);
 fd.append("upload_preset",PRESET);
 let r=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD}/${res}/upload`,{
  method:"POST",body:fd
 });
 return (await r.json()).secure_url;
}
window.pickMedia=type=>{
 fileInput.accept=type+"/*";
 fileInput.click();
 fileInput.onchange=async()=>{
  let f=fileInput.files[0];
  if(!f)return;
  let url=await uploadCloud(f,type);
  push(msgRef,{nick,dp,type,url,time:Date.now(),seen:false});
 };
};

/* VOICE */
window.recordVoice=async()=>{
 let s=await navigator.mediaDevices.getUserMedia({audio:true});
 let r=new MediaRecorder(s),c=[];
 r.start();r.ondataavailable=e=>c.push(e.data);
 setTimeout(()=>r.stop(),3000);
 r.onstop=async()=>{
  let b=new Blob(c,{type:"audio/webm"});
  let url=await uploadCloud(b,"video");
  push(msgRef,{nick,dp,type:"voice",url,time:Date.now(),seen:false});
 };
};

/* WALLPAPER */
window.pickWallpaper=()=>{
 fileInput.accept="image/*";
 fileInput.click();
 fileInput.onchange=()=>{
  let f=fileInput.files[0];
  if(!f)return;
  let r=new FileReader();
  r.onload=e=>{
   messages.style.backgroundImage=`url(${e.target.result})`;
   localStorage.setItem("public_wall",e.target.result);
  };
  r.readAsDataURL(f);
 };
};
let w=localStorage.getItem("public_wall");
if(w)messages.style.backgroundImage=`url(${w})`;

/* THEME */
window.changeTheme=()=>{
 let c=["#ff5c8d","#7c4dff","#4caf50","#ff9800"];
 document.documentElement.style.setProperty("--bubble",
  c[Math.floor(Math.random()*c.length)]
 );
};

/* LOAD + SEEN */
let selectedId=null, selectedData=null;

onValue(msgRef,s=>{
 messages.innerHTML="";
 s.forEach(c=>{
  let d=c.val(),me=d.nick===nick;
  if(!me && !d.seen)
   update(ref(db,base+"/messages/"+c.key),{seen:true});

  let div=document.createElement("div");
  div.className="msg "+(me?"right":"left");
  div.innerHTML=`
   ${!me?`<img class="dp" src="${d.dp}">`:""}
   <div class="bubble">
    <div class="nick">${me?"You":d.nick}</div>
    ${d.reply?`<div class="reply">${d.reply}</div>`:""}
    ${
     d.type==="text"?d.text:
     d.type==="image"?`<img class="chat-img" src="${d.url}">`:
     d.type==="video"?`<video controls src="${d.url}"></video>`:
     `<audio controls src="${d.url}"></audio>`
    }
    ${me?`<div class="seen">${d.seen?"âœ”âœ” Seen":"âœ” Sent"}</div>`:""}
   </div>
   ${me?`<img class="dp" src="${d.dp}">`:""}
  `;

  /* LONG PRESS */
  div.oncontextmenu=e=>{
   e.preventDefault();
   selectedId=c.key;
   selectedData=d;
   context.style.display="block";
  };

  messages.appendChild(div);
 });
 messages.scrollTop=messages.scrollHeight;
});

/* CONTEXT ACTIONS */
window.replyMsg=()=>{
 msg.value="â†© "+(selectedData.text||"")+"\n";
 context.style.display="none";
};
window.editMsg=()=>{
 if(selectedData.type!=="text")return;
 let t=prompt("Edit message",selectedData.text);
 if(t) update(ref(db,base+"/messages/"+selectedId),{text:t});
 context.style.display="none";
};
window.unsendMsg=()=>{
 update(ref(db,base+"/messages/"+selectedId),{text:"ğŸš« Message unsent"});
 context.style.display="none";
};
window.deleteMsg=()=>{
 remove(ref(db,base+"/messages/"+selectedId));
 context.style.display="none";
};
window.downloadMsg=()=>{
 if(selectedData.url){
  let a=document.createElement("a");
  a.href=selectedData.url;
  a.download="";
  a.click();
 }
 context.style.display="none";
};

document.body.onclick=()=>context.style.display="none";
</script>

</body>
</html>
